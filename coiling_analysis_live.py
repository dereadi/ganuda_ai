#!/usr/bin/env python3
"""Cherokee Council: Live Coiling Analysis"""

import json
from datetime import datetime
from coinbase.rest import RESTClient

print("üåÄ COILING PATTERN ANALYSIS - LIVE")
print("=" * 70)
print(f"‚è∞ Time: {datetime.now().strftime('%H:%M:%S')}")
print()

# Get live prices
config = json.load(open("/home/dereadi/scripts/claude/cdp_api_key_new.json"))
key = config["name"].split("/")[-1]
client = RESTClient(api_key=key, api_secret=config["privateKey"], timeout=10)

# Get current prices
prices = {}
for coin in ['BTC', 'ETH', 'SOL']:
    try:
        ticker = client.get_product(f"{coin}-USD")
        prices[coin] = float(ticker.price)
    except:
        prices[coin] = 0

print("üìä CURRENT PRICES:")
print("-" * 40)
print(f"BTC: ${prices['BTC']:,.2f}")
print(f"ETH: ${prices['ETH']:,.2f}")
print(f"SOL: ${prices['SOL']:,.2f}")
print()

# Coiling analysis
print("üåÄ COILING INDICATORS:")
print("-" * 40)

# BTC coiling
btc_range = {
    "support": 108000,
    "resistance": 111000,
    "current": prices['BTC'],
    "range_pct": ((111000 - 108000) / 110000) * 100
}

btc_position = ((prices['BTC'] - btc_range['support']) / (btc_range['resistance'] - btc_range['support'])) * 100

print(f"BTC COILING:")
print(f"  Range: ${btc_range['support']:,} - ${btc_range['resistance']:,}")
print(f"  Current: ${prices['BTC']:,.2f} ({btc_position:.1f}% of range)")
print(f"  Range width: {btc_range['range_pct']:.1f}% (TIGHT!)")
if btc_position > 70:
    print(f"  ‚ö†Ô∏è NEAR RESISTANCE - Breakout imminent!")
elif btc_position < 30:
    print(f"  ‚ö†Ô∏è NEAR SUPPORT - Bounce expected!")
else:
    print(f"  üåÄ MID-RANGE - Coiling continues")
print()

# ETH coiling
eth_range = {
    "support": 4250,
    "resistance": 4350,
    "current": prices['ETH'],
    "range_pct": ((4350 - 4250) / 4300) * 100
}

eth_position = ((prices['ETH'] - eth_range['support']) / (eth_range['resistance'] - eth_range['support'])) * 100

print(f"ETH COILING:")
print(f"  Range: ${eth_range['support']:,} - ${eth_range['resistance']:,}")
print(f"  Current: ${prices['ETH']:,.2f} ({eth_position:.1f}% of range)")
print(f"  Range width: {eth_range['range_pct']:.1f}% (VERY TIGHT!)")
if eth_position > 70:
    print(f"  ‚ö†Ô∏è TESTING RESISTANCE - Breakout setup!")
elif eth_position < 30:
    print(f"  ‚ö†Ô∏è TESTING SUPPORT - Buy zone!")
else:
    print(f"  üåÄ COILING - Building pressure")
print()

# SOL analysis
sol_range = {
    "support": 200,
    "resistance": 210,
    "current": prices['SOL'],
    "range_pct": ((210 - 200) / 205) * 100
}

sol_position = ((prices['SOL'] - sol_range['support']) / (sol_range['resistance'] - sol_range['support'])) * 100

print(f"SOL PATTERN:")
print(f"  Range: ${sol_range['support']:,} - ${sol_range['resistance']:,}")
print(f"  Current: ${prices['SOL']:,.2f} ({sol_position:.1f}% of range)")
print(f"  Range width: {sol_range['range_pct']:.1f}%")
print()

# Coiling convergence
print("‚ö° CONVERGENCE ANALYSIS:")
print("-" * 40)
all_coiling = btc_range['range_pct'] < 3 and eth_range['range_pct'] < 3
if all_coiling:
    print("üî• EXTREME COILING DETECTED!")
    print("‚Ä¢ BTC and ETH both in ultra-tight ranges")
    print("‚Ä¢ Explosive move imminent (likely UP)")
    print("‚Ä¢ Institutional buying + coiling = MOON")
else:
    print("‚Ä¢ Markets coiling but not extreme yet")
    print("‚Ä¢ Continue monitoring for tightening")

print()
print("üéØ BREAKOUT TARGETS:")
print("-" * 40)
print(f"BTC breakout above ${btc_range['resistance']:,}:")
print(f"  ‚Üí First target: $112,500")
print(f"  ‚Üí Second target: $115,000")
print(f"  ‚Üí Moon target: $120,000")
print()
print(f"ETH breakout above ${eth_range['resistance']:,}:")
print(f"  ‚Üí First target: $4,500")
print(f"  ‚Üí Second target: $4,750")
print(f"  ‚Üí Moon target: $5,000")
print()

# Trading strategy
print("üî• CHEROKEE COUNCIL COILING STRATEGY:")
print("-" * 40)
if btc_position > 60 and eth_position > 60:
    print("‚ö†Ô∏è BOTH NEAR RESISTANCE!")
    print("Strategy: Prepare for breakout")
    print("‚Ä¢ Set alerts at resistance levels")
    print("‚Ä¢ Buy on confirmed breakout")
    print("‚Ä¢ Tight stops below breakout level")
elif btc_position < 40 or eth_position < 40:
    print("‚úÖ ACCUMULATION ZONE!")
    print("Strategy: Buy the coil")
    print("‚Ä¢ Add to positions near support")
    print("‚Ä¢ Scale in gradually")
    print("‚Ä¢ Hold for breakout")
else:
    print("üåÄ PATIENCE REQUIRED")
    print("Strategy: Wait for extremes")
    print("‚Ä¢ Don't chase mid-range")
    print("‚Ä¢ Wait for support or resistance test")
    print("‚Ä¢ Keep powder dry")

print()
print("üìà PROBABILITY ASSESSMENT:")
print("-" * 40)
up_probability = 65  # Base probability
if "institutional" in "context":  # Today's ETH news
    up_probability += 10
if btc_position > 50:
    up_probability += 5
if eth_position > 50:
    up_probability += 5

print(f"Breakout UP probability: {up_probability}%")
print(f"Breakout DOWN probability: {100 - up_probability}%")
print()
print("üêøÔ∏è Flying Squirrel: 'The spring coils tighter...'")
print("ü¶Ö Eagle Eye: 'Breakout within 24-48 hours'")
print("üê∫ Coyote: 'Fake breakdown then moon'")

# Save analysis
analysis = {
    "timestamp": datetime.now().isoformat(),
    "prices": prices,
    "btc_coiling": {
        "range": [btc_range['support'], btc_range['resistance']],
        "position_pct": btc_position,
        "width_pct": btc_range['range_pct']
    },
    "eth_coiling": {
        "range": [eth_range['support'], eth_range['resistance']],
        "position_pct": eth_position,
        "width_pct": eth_range['range_pct']
    },
    "breakout_probability_up": up_probability
}

with open('/home/dereadi/scripts/claude/coiling_analysis.json', 'w') as f:
    json.dump(analysis, f, indent=2)

print("\nüíæ Coiling analysis saved")