# fail2ban action: Send Telegram notification on ban/unban
# Cherokee AI Federation - Security Phase 3
#
# REQUIRES ADMIN: Deploy with:
#   sudo cp /ganuda/config/fail2ban-action-telegram.conf /etc/fail2ban/action.d/telegram.conf
#
# Environment requirement: TELEGRAM_BOT_TOKEN must be set in
#   /etc/fail2ban/fail2ban.local or /etc/default/fail2ban

[Definition]

# Option: actionstart
# Notes:  Command executed on jail start
actionstart =

# Option: actionstop
# Notes:  Command executed on jail stop
actionstop =

# Option: actioncheck
# Notes:  Command executed before each ban
actioncheck =

# Option: actionban
# Notes:  Command executed when banning an IP
actionban = /usr/bin/curl -s -X POST \
              "https://api.telegram.org/bot<telegram_token>/sendMessage" \
              -d chat_id="<telegram_chat_id>" \
              -d parse_mode="Markdown" \
              -d text="*[FAIL2BAN ALERT]* %0A*Node:* $(hostname) %0A*Jail:* <name> %0A*Action:* BAN %0A*IP:* <ip> %0A*Failures:* <failures> %0A*Time:* $(date '+%%Y-%%m-%%d %%H:%%M:%%S %%Z')" \
              > /dev/null 2>&1

# Option: actionunban
# Notes:  Command executed when unbanning an IP
actionunban = /usr/bin/curl -s -X POST \
                "https://api.telegram.org/bot<telegram_token>/sendMessage" \
                -d chat_id="<telegram_chat_id>" \
                -d parse_mode="Markdown" \
                -d text="*[FAIL2BAN INFO]* %0A*Node:* $(hostname) %0A*Jail:* <name> %0A*Action:* UNBAN %0A*IP:* <ip> %0A*Time:* $(date '+%%Y-%%m-%%d %%H:%%M:%%S %%Z')" \
                > /dev/null 2>&1

[Init]
# Telegram bot token -- override in jail.local or /etc/default/fail2ban
telegram_token = TELEGRAM_BOT_TOKEN_PLACEHOLDER
# Telegram chat ID for security alerts channel
telegram_chat_id = TELEGRAM_CHAT_ID_PLACEHOLDER
