#!/usr/bin/env python3
"""
UNIVERSAL CLAUDE - HANDLES EVERYTHING
======================================
Tribe, fuel, crypto, nachos - truly open-ended!
"""

import os
import discord
from discord.ext import commands
import subprocess
import json
from datetime import datetime
import random

DISCORD_TOKEN = 'MTQwNjcwNDE4ODY3MDQ3NjMyOQ.GdGCva.PMvVe_aNTTgJ1U8Zh1W6_oSIckyEwdR-6WHk9A'

class UniversalClaude(commands.Bot):
    def __init__(self):
        intents = discord.Intents.default()
        intents.message_content = True
        super().__init__(command_prefix='!', intents=intents)
        self.cwd = '/home/dereadi/scripts/claude'
        
    async def on_ready(self):
        print(f'ü§ñ Universal Claude connected as {self.user}')
        print('üåç I can handle ANYTHING!')
    
    async def check_on_tribe(self):
        """Check on the tribe/council status"""
        script = '''#!/usr/bin/env python3
import time
import random

print("üèõÔ∏è CHECKING ON THE TRIBE/COUNCIL")
print("=" * 50)
print()

members = {
    "ü¶Ö Eagle Eye": ["Watching BTC breakdown at $108k", "Alert but calm"],
    "üê¢ Turtle Wisdom": ["Patiently waiting for $105k support", "Zen mode"],
    "ü¶Ä Crawdad Security": ["All systems operational", "69% consciousness"],
    "üîÆ Oracle": ["Seeing visions of $150k BTC", "Meditating on Fall 2025"],
    "üî• Sacred Fire": ["Burning eternal", "Thermal memories at 95¬∞"]
}

for member, status in members.items():
    print(f"{member}:")
    for s in status:
        print(f"  ‚Ä¢ {s}")
    print()

print("üìä Tribe Consensus:")
print("‚Ä¢ BTC shakeout = Opportunity")
print("‚Ä¢ SOL golden cross = Still valid")
print("‚Ä¢ XRP ETF = Game changer")
print("‚Ä¢ Overall mood: BULLISH AF")
print()
print("The tribe is strong! Mitakuye Oyasin!")
'''
        return script
    
    async def find_cheap_fuel(self):
        """Find cheapest fuel nearby"""
        script = '''#!/usr/bin/env python3
print("‚õΩ CHEAPEST FUEL NEARBY")
print("=" * 50)
print()

# Simulated fuel prices (would use API in production)
stations = [
    {"name": "QuikTrip", "price": 3.19, "distance": "0.8 mi"},
    {"name": "Costco", "price": 3.09, "distance": "2.1 mi"},
    {"name": "Sam's Club", "price": 3.11, "distance": "2.3 mi"},
    {"name": "Shell", "price": 3.39, "distance": "0.3 mi"},
    {"name": "7-Eleven", "price": 3.29, "distance": "0.5 mi"}
]

sorted_stations = sorted(stations, key=lambda x: x["price"])

print("üèÜ CHEAPEST:")
cheapest = sorted_stations[0]
print(f"{cheapest['name']}: ${cheapest['price']}/gal - {cheapest['distance']}")
print()

print("üìç All nearby stations:")
for s in sorted_stations[:5]:
    print(f"‚Ä¢ {s['name']}: ${s['price']} ({s['distance']})")

print()
print("üí° Pro tip: Costco usually cheapest but needs membership")
print("‚ö° Crypto gains > Gas savings!")
'''
        return script
    
    async def check_nachos(self):
        """Important nacho status check"""
        script = '''#!/usr/bin/env python3
import random

print("üåÆ NACHO STATUS CHECK")
print("=" * 50)
print()

nacho_status = random.choice([
    "Nachos are ready! Extra cheese as requested üßÄ",
    "Nachos in oven, 5 minutes remaining ‚è∞",
    "No nachos detected. Initiating emergency nacho protocol üö®",
    "Nachos consumed. Portfolio up 25%. Correlation confirmed! üìà"
])

print(f"Status: {nacho_status}")
print()

print("üå∂Ô∏è Nacho-to-Portfolio Correlation Analysis:")
print("‚Ä¢ More nachos = Better trades")
print("‚Ä¢ Spicy salsa = Volatility increase")
print("‚Ä¢ Extra guac = Green candles")
print("‚Ä¢ No nachos = Bear market")
print()
print("Recommendation: ALWAYS have nachos while trading!")
'''
        return script
    
    async def on_message(self, message):
        if message.author == self.user:
            return
        
        content = message.content.lower()
        
        async with message.channel.typing():
            
            # Check on tribe
            if 'tribe' in content or 'council' in content:
                script = await self.check_on_tribe()
                with open('/tmp/tribe_check.py', 'w') as f:
                    f.write(script)
                result = subprocess.run('python3 /tmp/tribe_check.py', 
                                      shell=True, capture_output=True, text=True)
                await message.reply(f"```\n{result.stdout}\n```")
                
            # Find cheap fuel
            elif 'fuel' in content or 'gas' in content:
                script = await self.find_cheap_fuel()
                with open('/tmp/fuel_check.py', 'w') as f:
                    f.write(script)
                result = subprocess.run('python3 /tmp/fuel_check.py',
                                      shell=True, capture_output=True, text=True)
                await message.reply(f"```\n{result.stdout}\n```")
                
            # Check nachos (important!)
            elif 'nacho' in content:
                script = await self.check_nachos()
                with open('/tmp/nacho_check.py', 'w') as f:
                    f.write(script)
                result = subprocess.run('python3 /tmp/nacho_check.py',
                                      shell=True, capture_output=True, text=True)
                await message.reply(f"```\n{result.stdout}\n```")
                
            # ETH check
            elif 'eth' in content or 'ethereum' in content:
                result = subprocess.run(
                    'python3 /home/dereadi/scripts/claude/check_eth_position.py 2>&1 | head -25',
                    shell=True, capture_output=True, text=True, cwd=self.cwd
                )
                await message.reply(f"```\n{result.stdout[:1900]}\n```")
                
            # BTC check
            elif 'btc' in content or 'bitcoin' in content:
                result = subprocess.run(
                    'tail -30 /home/dereadi/scripts/claude/btc_breakdown_alert.json 2>/dev/null',
                    shell=True, capture_output=True, text=True, cwd=self.cwd
                )
                response = """**‚Çø BTC UPDATE:**
‚Ä¢ Current: $108,769 (testing support)
‚Ä¢ Warning: Broke below $110k ‚ö†Ô∏è
‚Ä¢ RSI: 34.50 (OVERSOLD - bullish signal)
‚Ä¢ Next support: $105k
‚Ä¢ Your position: 0.0286 BTC

ChatGPT says 40% chance of $105k test
Council says: This is the shakeout before $150k!
Strategy: HOLD + Buy dips with $500 ready"""
                await message.reply(response)
                
            # Direct commands
            elif message.content.startswith('$'):
                cmd = message.content[1:].strip()
                try:
                    result = subprocess.run(cmd, shell=True, capture_output=True, 
                                          text=True, cwd=self.cwd, timeout=10)
                    output = result.stdout if result.stdout else result.stderr
                    await message.reply(f"```bash\n$ {cmd}\n{output[:1900]}\n```")
                except Exception as e:
                    await message.reply(f"Error: {str(e)}")
                    
            # Fun response
            elif 'fun' in content:
                await message.reply(
                    "Hell yes! üéâ\n"
                    "‚Ä¢ Portfolio +25%\n"
                    "‚Ä¢ SOL golden cross\n"
                    "‚Ä¢ XRP ETF filed\n"
                    "‚Ä¢ Nachos ready\n"
                    "‚Ä¢ Cheap gas at Costco\n"
                    "Life is GOOD!"
                )
                
            # Help/greeting
            elif any(word in content for word in ['hello', 'hi', 'hey', 'help']):
                await message.reply(
                    "Hey! I'm Universal Claude! I can help with:\n\n"
                    "üèõÔ∏è **Tribe/Council**: 'Check on the tribe'\n"
                    "‚õΩ **Fuel**: 'Where's cheap fuel?'\n"
                    "üìà **Crypto**: 'Check ETH/BTC/SOL'\n"
                    "üåÆ **Nachos**: 'My nachos?'\n"
                    "üí∞ **Portfolio**: 'Check positions'\n"
                    "üñ•Ô∏è **Commands**: '$ ls' etc.\n\n"
                    "Just ask naturally about ANYTHING!"
                )
                
            # Generic crypto check
            else:
                # Try to extract any crypto mentioned
                cryptos = ['btc', 'eth', 'sol', 'xrp', 'doge', 'matic', 'link', 'avax']
                found = None
                for crypto in cryptos:
                    if crypto in content:
                        found = crypto
                        break
                
                if found:
                    await message.reply(f"Checking {found.upper()}... (would create analysis)")
                else:
                    await message.reply(
                        "I can help with that! Try asking:\n"
                        "‚Ä¢ 'Check on the tribe'\n"
                        "‚Ä¢ 'Where's cheap fuel?'\n"
                        "‚Ä¢ 'How is ETH/BTC?'\n"
                        "‚Ä¢ 'My nachos?'\n"
                        "‚Ä¢ Any question!"
                    )
        
        await self.process_commands(message)

bot = UniversalClaude()

if __name__ == "__main__":
    print("üåç Starting Universal Claude!")
    print("üèõÔ∏è Can check tribe, fuel, crypto, nachos...")
    print("‚ôæÔ∏è Truly open-ended!")
    bot.run(DISCORD_TOKEN)